
<input name="attr_version" value="0" type="hidden"/>
<div class="slugblaster">
  <div class="slugblaster__wrapper">
    <header class="header">
      <h2 data-i18n="slugblaster">Slugblaster</h2>
      <h4><span name="attr_sheet_mode" data-i18n-dynamic="data-i18n-dynamic"></span></h4>
      <div class="header__modes">
        <button class="header__action header--character" name="act_character" type="action"><span class="header__action--label" data-i18n="character">Character</span>
        </button>
        <button class="header__action header--crew" name="act_crew" type="action"><span class="header__action--label" data-i18n="crew">Crew</span>
        </button>
      </div>
    </header>
    <main class="character">
      <section class="character__style-trouble">
        <div class="blob style-trouble">
          <input class="editor__controller" name="attr_style-trouble_editor" type="hidden" value="0"/>
          <div class="blob__wrapper">
            <div class="blob__content style-trouble__content">
              <div class="style">
                <h2 class="style__title" data-i18n="style">Style</h2>
                <div class="style__track">
                  <label class="style__checkbox">
                    <input class="checkbox--circle" name="attr_style" value="on" type="radio"/><span class="visually-hidden" data-i18n="style_0"></span>
                  </label>
                  <label class="style__checkbox">
                    <input class="checkbox--circle" name="attr_style" value="1" type="radio"/><span class="visually-hidden" data-i18n="style_1"></span>
                  </label>
                  <label class="style__checkbox">
                    <input class="checkbox--circle" name="attr_style" value="2" type="radio"/><span class="visually-hidden" data-i18n="style_2"></span>
                  </label>
                  <label class="style__checkbox">
                    <input class="checkbox--circle" name="attr_style" value="3" type="radio"/><span class="visually-hidden" data-i18n="style_3"></span>
                  </label>
                  <label class="style__checkbox">
                    <input class="checkbox--circle" name="attr_style" value="4" type="radio"/><span class="visually-hidden" data-i18n="style_4"></span>
                  </label>
                  <label class="style__checkbox">
                    <input class="checkbox--circle" name="attr_style" value="5" type="radio"/><span class="visually-hidden" data-i18n="style_5"></span>
                  </label>
                  <label class="style__checkbox">
                    <input class="checkbox--circle" name="attr_style" value="6" type="radio"/><span class="visually-hidden" data-i18n="style_6"></span>
                  </label>
                  <label class="style__checkbox">
                    <input class="checkbox--circle" name="attr_style" value="7" type="radio"/><span class="visually-hidden" data-i18n="style_7"></span>
                  </label>
                  <label class="style__checkbox">
                    <input class="checkbox--circle" name="attr_style" value="8" type="radio"/><span class="visually-hidden" data-i18n="style_8"></span>
                  </label>
                </div><span name="attr_style_run_bonus"></span>
              </div>
              <div class="trouble">
                <div class="trouble__actions">
                  <h2 class="trouble__title" data-i18n="trouble">Trouble</h2>
                  <button class="trouble__action trouble--nope" name="act_nope" type="action"><span class="trouble__action--label" data-i18n="nope">Nope!</span>
                  </button>
                  <button class="trouble__action trouble--disaster" name="act_disaster" type="action"><span class="trouble__action--label" data-i18n="disaster">Disaster</span>
                  </button>
                </div>
                <div class="trouble__track">
                  <label class="trouble__checkbox">
                    <input class="checkbox--circle" name="attr_trouble" value="on" type="radio"/><span class="visually-hidden" data-i18n="trouble_0"></span>
                  </label>
                  <label class="trouble__checkbox">
                    <input class="checkbox--circle" name="attr_trouble" value="1" type="radio"/><span class="visually-hidden" data-i18n="trouble_1"></span>
                  </label>
                  <label class="trouble__checkbox">
                    <input class="checkbox--circle" name="attr_trouble" value="2" type="radio"/><span class="visually-hidden" data-i18n="trouble_2"></span>
                  </label>
                  <label class="trouble__checkbox">
                    <input class="checkbox--circle" name="attr_trouble" value="3" type="radio"/><span class="visually-hidden" data-i18n="trouble_3"></span>
                  </label>
                  <label class="trouble__checkbox">
                    <input class="checkbox--circle" name="attr_trouble" value="4" type="radio"/><span class="visually-hidden" data-i18n="trouble_4"></span>
                  </label>
                  <label class="trouble__checkbox">
                    <input class="checkbox--circle" name="attr_trouble" value="5" type="radio"/><span class="visually-hidden" data-i18n="trouble_5"></span>
                  </label>
                  <label class="trouble__checkbox">
                    <input class="checkbox--circle" name="attr_trouble" value="6" type="radio"/><span class="visually-hidden" data-i18n="trouble_6"></span>
                  </label>
                  <label class="trouble__checkbox">
                    <input class="checkbox--circle" name="attr_trouble" value="7" type="radio"/><span class="visually-hidden" data-i18n="trouble_7"></span>
                  </label>
                  <label class="trouble__checkbox">
                    <input class="checkbox--circle" name="attr_trouble" value="8" type="radio"/><span class="visually-hidden" data-i18n="trouble_8"></span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="character__col">
        <div class="panel your_character">
          <input class="editor__controller" name="attr_your_character_editor" type="hidden" value="0"/>
          <div class="panel__wrapper">
            <div class="panel__header your_character__header">
              <input class="header__personality header__input--text character__title" name="attr_personality" id="personality" type="text" value="" data-i18n-placeholder="placeholder_personality" placeholder="Personality"/>
              <button class="edit-toggle" name="act_your_character-editor" type="action">
                <input class="edit-toggle__controller" name="attr_your_character_editor" type="hidden" value="0"/>
                <div class="edit-toggle__edit"><span class="visually-hidden" data-i18n="edit">Edit</span><span class="pictos">*</span></div>
                <div class="edit-toggle__view"><span class="visually-hidden" data-i18n="view">View</span><span class="pictos">y</span></div>
              </button>
            </div>
            <div class="panel__content your_character__content">
              <div class="editor">
                <div class="editor__edit header__edit">
                  <div>
                    <label for="character_name" data-i18n="character_name">Name</label>
                    <input class="header__character_name header__input--text" name="attr_character_name" id="character_name" type="text" value="" data-i18n-placeholder="placeholder_character_name" placeholder="Farrah"/>
                  </div>
                  <div>
                    <label for="look" data-i18n="look">Look</label>
                    <input class="header__look header__input--text" name="attr_look" id="look" type="text" value="" data-i18n-placeholder="placeholder_look" placeholder="all black, muted, chains"/>
                  </div>
                  <div>
                    <label for="family" data-i18n="family">Family</label>
                    <input class="header__family header__input--text" name="attr_family" id="family" type="text" value="" data-i18n-placeholder="placeholder_family" placeholder="strict"/>
                  </div>
                  <div>
                    <label for="bond" data-i18n="bond">Bond</label>
                    <input class="header__bond header__input--text" name="attr_bond" id="bond" type="text" value="" data-i18n-placeholder="placeholder_bond" placeholder="natural chemistry"/>
                  </div>
                  <div>
                    <label for="vibes" data-i18n="vibes">Vibes</label>
                    <input class="header__vibes header__input--text" name="attr_vibes" id="vibes" type="text" value="" data-i18n-placeholder="placeholder_vibes" placeholder="space cadet"/>
                  </div>
                  <div>
                    <label for="stickers" data-i18n="stickers">Stickers, etc.</label>
                    <input class="header__stickers header__input--text" name="attr_stickers" id="stickers" type="text" value="" data-i18n-placeholder="placeholder_stickers" placeholder="'Skate and/or Die' beside a cat in a box"/>
                  </div>
                </div>
                <div class="editor__view header__view">
                  <div><span name="attr_character_name"></span>
                    <label data-i18n="character_name">Name</label>
                  </div>
                  <div><span name="attr_look"></span>
                    <label data-i18n="look">Look</label>
                  </div>
                  <div><span name="attr_family"></span>
                    <label data-i18n="family">Family</label>
                  </div>
                  <div><span name="attr_bond"></span>
                    <label data-i18n="bond">Bond</label>
                  </div>
                  <div><span name="attr_vibes"></span>
                    <label data-i18n="vibes">Vibes</label>
                  </div>
                  <div><span name="attr_stickers"></span>
                    <label data-i18n="stickers">Stickers, etc.</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <section class="character__gear">
          <div class="panel gear">
            <input class="editor__controller" name="attr_gear_editor" type="hidden" value="0"/>
            <div class="panel__wrapper">
              <div class="panel__header gear__header">
                <h2 class="panel__title gear__title" data-i18n="gear">Gear</h2>
                <button class="edit-toggle" name="act_gear-editor" type="action">
                  <input class="edit-toggle__controller" name="attr_gear_editor" type="hidden" value="0"/>
                  <div class="edit-toggle__edit"><span class="visually-hidden" data-i18n="edit">Edit</span><span class="pictos">*</span></div>
                  <div class="edit-toggle__view"><span class="visually-hidden" data-i18n="view">View</span><span class="pictos">y</span></div>
                </button>
              </div>
              <div class="panel__content gear__content">
                <div class="editor">
                  <div class="editor__edit gear__edit">
                    <div class="gear__item">
                      <label class="gear__label" data-i18n="your_board">Your Board</label>
                      <input class="gear__your_board gear__input--text" name="attr_your_board" id="your_board" type="text" value="" data-i18n-placeholder="placeholder_your_board" placeholder="street deck with hologram griptape"/>
                    </div>
                    <div class="gear__item">
                      <label class="gear__label" data-i18n="your_raygun">Your Raygun</label>
                      <input class="gear__your_raygun gear__input--text" name="attr_your_raygun" id="your_raygun" type="text" value="" data-i18n-placeholder="placeholder_your_raygun" placeholder="circuit-bent photon pistol"/>
                    </div>
                  </div>
                  <div class="editor__view gear__view">
                    <div class="gear__item"><span name="attr_your_board"></span>
                      <label class="gear__label" data-i18n="your_board">Your Board</label>
                    </div>
                    <div class="gear__item"><span name="attr_your_raygun"></span>
                      <label class="gear__label" data-i18n="your_raygun">Your Raygun</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="blob gear">
            <input class="editor__controller" name="attr_gear_editor" type="hidden" value="0"/>
            <div class="blob__wrapper">
              <div class="repeating">
                <input class="repeating__is-empty" name="attr_gear_empty" value="0" type="hidden"/>
                <input class="repeating__controller" name="attr_gear_editor" type="hidden"/>
                <div class="repeating__empty">
                  <div class="repeating__header"><span data-i18n="none_gear_repeating">None gear left beef</span></div>
                  <div class="repeating__subtitle"></div>
                </div>
                <fieldset class="repeating_gear">
                  <div class="repeating__edit">
                    <div class="row gear__edit">
                      <input name="attr_gear_autogen" value="" type="hidden"/>
                      <div class="gear__field gear_check col-1">
                        <input class="checkbox--scribble" name="attr_gear_check" value="on" type="checkbox"/>
                        <label class="visually-hidden" for="gear_check" data-i18n="gear_check">Select Gear</label>
                      </div>
                      <div class="gear__field gear_name col-11">
                        <input class="gear__gear_name gear__input--text" name="attr_gear_name" id="gear_name" type="text" value="" data-i18n-placeholder="placeholder_gear_name" placeholder="grappling hook"/>
                        <label class="visually-hidden" for="gear_name" data-i18n="gear_name">Gear</label>
                      </div>
                      <div class="gear__field gear_cost ">
                        <input class="gear__gear_cost gear__input--text" name="attr_gear_cost" id="gear_cost" type="text" value="" data-i18n-placeholder="placeholder_gear_cost" placeholder="1 coil"/>
                        <label for="gear_cost" data-i18n="gear_cost">Cost</label>
                      </div>
                      <div class="gear__field gear_description ">
                        <textarea class="gear__gear_description gear__input--textarea" name="attr_gear_description" value="" data-i18n-placeholder="placeholder_gear_description" placeholder="A pistol-sized launcher that fires an anti-negafriction dart which sticks firmly to most surfaces until switched off. The dart is attached to a hundred feet of lightweight carbon-fibre cable, which can be retracted via the launcher’s micro-winch."></textarea>
                        <label for="gear_description" data-i18n="gear_description">Description</label>
                      </div>
                    </div>
                  </div>
                  <div class="repeating__view">
                    <div class="gear__view">
                      <label class="gear__check">
                        <input class="checkbox--scribble" name="attr_gear_check" value="on" type="checkbox"/><span name="attr_gear_name"></span>
                      </label>
                    </div>
                  </div>
                  <div class="repeating__delete">
                  </div>
                </fieldset>
              </div>
              <div class="blob__content gear__content">
              </div>
            </div>
          </div>
        </section>
      </section>
      <section class="character__col">
        <section class="character__attitude">
          <div class="blob attitude">
            <input class="editor__controller" name="attr_attitude_editor" type="hidden" value="0"/>
            <div class="blob__wrapper">
              <div class="blob__header attitude__header">
                <h2 class="blob__title attitude__title" data-i18n="attitude">Attitude</h2>
              </div>
              <div class="blob__content attitude__content"><span name="attr_attitude_subtitle"></span>
                <input name="attr_attitude_boost" value="" type="hidden"/>
                <input name="attr_attitude_kick" value="" type="hidden"/>
                <div class="attitude__clickies">
                  <input class="attitude__boost" name="attr_attitude_boost_1" value="on" type="checkbox"/>
                  <input class="attitude__boost" name="attr_attitude_boost_2" value="on" type="checkbox"/>
                  <input class="attitude__kick" name="attr_attitude_kick_1" value="on" type="checkbox"/>
                  <input class="attitude__kick" name="attr_attitude_kick_2" value="on" type="checkbox"/>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section class="character__traits">
          <div class="panel traits">
            <input class="editor__controller" name="attr_traits_editor" type="hidden" value="0"/>
            <div class="panel__wrapper">
              <div class="panel__header traits__header">
                <h2 class="panel__title traits__title" data-i18n="traits">Traits</h2>
                <button class="edit-toggle" name="act_traits-editor" type="action">
                  <input class="edit-toggle__controller" name="attr_traits_editor" type="hidden" value="0"/>
                  <div class="edit-toggle__edit"><span class="visually-hidden" data-i18n="edit">Edit</span><span class="pictos">*</span></div>
                  <div class="edit-toggle__view"><span class="visually-hidden" data-i18n="view">View</span><span class="pictos">y</span></div>
                </button>
              </div>
              <div class="panel__content traits__content">
                <div class="repeating">
                  <input class="repeating__is-empty" name="attr_traits_empty" value="0" type="hidden"/>
                  <input class="repeating__controller" name="attr_traits_editor" type="hidden"/>
                  <div class="repeating__empty">
                    <div class="repeating__header"><span data-i18n="none_traits_repeating">None traits left beef</span></div>
                    <div class="repeating__subtitle"></div>
                  </div>
                  <fieldset class="repeating_traits">
                    <div class="repeating__edit">
                      <div class="row traits__edit">
                        <input name="attr_trait_autogen" value="" type="hidden"/>
                        <div class="traits__field trait_check col-1">
                          <input class="checkbox--scribble" name="attr_trait_check" value="on" type="checkbox"/>
                          <label class="visually-hidden" for="trait_check" data-i18n="trait_check">Select trait</label>
                        </div>
                        <div class="traits__field trait_name col-11">
                          <input class="traits__trait_name traits__input--text" name="attr_trait_name" id="trait_name" type="text" value="" data-i18n-placeholder="placeholder_trait_name" placeholder="Patient"/>
                          <label class="visually-hidden" for="trait_name" data-i18n="trait_name">trait</label>
                        </div>
                        <div class="traits__field trait_description ">
                          <textarea class="traits__trait_description traits__input--textarea" name="attr_trait_description" value="" data-i18n-placeholder="placeholder_trait_description" placeholder="When you reveal how you’ve been waiting to act, get +1d6 or +1 kick on your action."></textarea>
                          <label for="trait_description" data-i18n="trait_description">Description</label>
                        </div>
                      </div>
                    </div>
                    <div class="repeating__view">
                      <div class="traits__view">
                        <label class="traits__check">
                          <input class="checkbox--scribble" name="attr_trait_check" value="on" type="checkbox"/><span class="trait__name" name="attr_trait_name"></span>
                        </label><span name="attr_trait_description"></span>
                      </div>
                    </div>
                    <div class="repeating__delete">
                    </div>
                  </fieldset>
                </div>
              </div>
            </div>
          </div>
        </section>
      </section>
      <section class="character__col">
        <section class="character__signature">
          <div class="blob turbo">
            <input class="editor__controller" name="attr_turbo_editor" type="hidden" value="0"/>
            <div class="blob__wrapper">
              <div class="blob__header turbo__header">
                <h2 class="blob__title turbo__title" data-i18n="turbo">Turbo</h2>
              </div>
              <div class="blob__content turbo__content"><span data-i18n="turbo_description">Describe how your device helps you with an action, then boost or kick as needed.</span>
                <input name="attr_turbo_boost" value="" type="hidden"/>
                <input name="attr_turbo_kick" value="" type="hidden"/>
                <div class="turbo__clickies">
                  <input class="turbo__boost" name="attr_turbo_boost_1" value="on" type="checkbox"/>
                  <input class="turbo__boost" name="attr_turbo_boost_2" value="on" type="checkbox"/>
                  <input class="turbo__boost" name="attr_turbo_boost_3" value="on" type="checkbox"/>
                  <input class="turbo__kick" name="attr_turbo_kick_1" value="on" type="checkbox"/>
                  <input class="turbo__kick" name="attr_turbo_kick_2" value="on" type="checkbox"/>
                  <input class="turbo__kick" name="attr_turbo_kick_3" value="on" type="checkbox"/>
                </div>
              </div>
            </div>
          </div>
          <div class="panel signature">
            <input class="editor__controller" name="attr_signature_editor" type="hidden" value="0"/>
            <div class="panel__wrapper">
              <div class="panel__header signature__header">
                <input class="header__signature header__input--text signature__title" name="attr_signature" id="signature" type="text" value="" data-i18n-placeholder="placeholder_signature" placeholder="Signature"/>
                <button class="edit-toggle" name="act_signature-editor" type="action">
                  <input class="edit-toggle__controller" name="attr_signature_editor" type="hidden" value="0"/>
                  <div class="edit-toggle__edit"><span class="visually-hidden" data-i18n="edit">Edit</span><span class="pictos">*</span></div>
                  <div class="edit-toggle__view"><span class="visually-hidden" data-i18n="view">View</span><span class="pictos">y</span></div>
                </button>
              </div>
              <div class="panel__content signature__content">
                <div class="editor">
                  <div class="editor__edit signature__edit">
                    <div class="signature--field">
                      <input class="signatures__signature_description signatures__input--text" name="attr_signature_description" id="signature_description" type="text" value="" data-i18n-placeholder="placeholder_signature_description" placeholder="Negafriction is just what it sounds like: complete nonsense."/>
                      <label data-i18n="signature_description">Description</label>
                    </div>
                    <div class="signature--field">
                      <input class="signatures__signature_function signatures__input--text" name="attr_signature_function" id="signature_function" type="text" value="" data-i18n-placeholder="placeholder_signature_function" placeholder="Roll to slice, dice, chop, and stab things (or nonlethally smack them with the kinetically-charged sheath)."/>
                      <label data-i18n="signature_function">Function</label>
                    </div>
                    <div class="signature--field">
                      <input class="signatures__signature_look signatures__input--text" name="attr_signature_look" id="signature_look" type="text" value="" data-i18n-placeholder="placeholder_signature_look" placeholder="hardlight katana"/>
                      <label data-i18n="signature_look">Look</label>
                    </div>
                  </div>
                  <div class="editor__view signature__view">
                    <div class="signature--field"><span name="attr_signature_description"></span>
                      <label data-i18n="signature_description">Description</label>
                    </div>
                    <div class="signature--field"><span name="attr_signature_function"></span>
                      <label data-i18n="signature_function">Function</label>
                    </div>
                    <div class="signature--field"><span name="attr_signature_look"></span>
                      <label data-i18n="signature_look">Look</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </section>
      <section class="character__col">
        <section class="character__legacy">
          <div class="panel legacy">
            <input class="editor__controller" name="attr_legacy_editor" type="hidden" value="0"/>
            <div class="panel__wrapper">
              <div class="panel__header legacy__header">
                <h2 class="panel__title legacy__title" data-i18n="legacy">legacy</h2>
                <button class="edit-toggle" name="act_legacy-editor" type="action">
                  <input class="edit-toggle__controller" name="attr_legacy_editor" type="hidden" value="0"/>
                  <div class="edit-toggle__edit"><span class="visually-hidden" data-i18n="edit">Edit</span><span class="pictos">*</span></div>
                  <div class="edit-toggle__view"><span class="visually-hidden" data-i18n="view">View</span><span class="pictos">y</span></div>
                </button>
              </div>
              <div class="panel__content legacy__content">
                <div class="repeating">
                  <input class="repeating__is-empty" name="attr_legacy_empty" value="0" type="hidden"/>
                  <input class="repeating__controller" name="attr_legacy_editor" type="hidden"/>
                  <div class="repeating__empty">
                    <div class="repeating__header"><span data-i18n="none_legacy_repeating">None legacy left beef</span></div>
                    <div class="repeating__subtitle"></div>
                  </div>
                  <fieldset class="repeating_legacy">
                    <div class="repeating__edit">
                      <div class="row legacy__edit">
                        <div class="legacy__field legacy_name ">
                          <input class="legacy__legacy_name legacy__input--text" name="attr_legacy_name" id="legacy_name" type="text" value="" data-i18n-placeholder="placeholder_legacy_name" placeholder="viral video of 1080"/>
                          <label for="legacy_name" data-i18n="legacy_name">Legacy</label>
                        </div>
                        <div class="legacy__field legacy_description ">
                          <textarea class="legacy__legacy_description legacy__input--textarea" name="attr_legacy_description" value="" data-i18n-placeholder="placeholder_legacy_description" placeholder=""></textarea>
                          <label for="legacy_description" data-i18n="legacy_description">Description</label>
                        </div>
                      </div>
                    </div>
                    <div class="repeating__view">
                      <div class="legacy__view"><span class="legacy__name" name="attr_legacy_name"></span><span name="attr_legacy_description"></span>
                      </div>
                    </div>
                    <div class="repeating__delete">
                    </div>
                  </fieldset>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section class="character__doom">
          <div class="panel doom">
            <input class="editor__controller" name="attr_doom_editor" type="hidden" value="0"/>
            <div class="panel__wrapper">
              <div class="panel__header doom__header">
                <h2 class="panel__title doom__title" data-i18n="doom">doom</h2>
                <button class="edit-toggle" name="act_doom-editor" type="action">
                  <input class="edit-toggle__controller" name="attr_doom_editor" type="hidden" value="0"/>
                  <div class="edit-toggle__edit"><span class="visually-hidden" data-i18n="edit">Edit</span><span class="pictos">*</span></div>
                  <div class="edit-toggle__view"><span class="visually-hidden" data-i18n="view">View</span><span class="pictos">y</span></div>
                </button>
              </div>
              <div class="panel__content doom__content">
                <div class="repeating">
                  <input class="repeating__is-empty" name="attr_doom_empty" value="0" type="hidden"/>
                  <input class="repeating__controller" name="attr_doom_editor" type="hidden"/>
                  <div class="repeating__empty">
                    <div class="repeating__header"><span data-i18n="none_doom_repeating">None doom left beef</span></div>
                    <div class="repeating__subtitle"></div>
                  </div>
                  <fieldset class="repeating_doom">
                    <div class="repeating__edit">
                      <div class="row doom__edit">
                        <div class="doom__field doom_name ">
                          <input class="doom__doom_name doom__input--text" name="attr_doom_name" id="doom_name" type="text" value="" data-i18n-placeholder="placeholder_doom_name" placeholder="broke mom's trust"/>
                          <label for="doom_name" data-i18n="doom_name">doom</label>
                        </div>
                        <div class="doom__field doom_description ">
                          <textarea class="doom__doom_description doom__input--textarea" name="attr_doom_description" value="" data-i18n-placeholder="placeholder_doom_description" placeholder=""></textarea>
                          <label for="doom_description" data-i18n="doom_description">Description</label>
                        </div>
                      </div>
                    </div>
                    <div class="repeating__view">
                      <div class="doom__view"><span class="doom__name" name="attr_doom_name"></span><span name="attr_doom_description"></span>
                      </div>
                    </div>
                    <div class="repeating__delete">
                    </div>
                  </fieldset>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section class="character__slams">
          <div class="blob slams">
            <input class="editor__controller" name="attr_slams_editor" type="hidden" value="0"/>
            <div class="blob__wrapper">
              <div class="blob__header slams__header">
                <h2 class="blob__title slams__title" data-i18n="slams">Slams</h2>
              </div>
              <div class="blob__content slams__content">
                <div class="slams__boxes">
                  <div class="slams__box slams__box--slam_1">
                    <input class="slams__slam_1 slams__input--text" name="attr_slam_1" id="slam_1" type="text" value="" data-i18n-placeholder="placeholder_slam_1" placeholder="slam"/>
                    <label class="visually-hidden" for="slam_1" data-i18n="slam_1">slams</label>
                  </div>
                  <div class="slams__box slams__box--slam_2">
                    <input class="slams__slam_2 slams__input--text" name="attr_slam_2" id="slam_2" type="text" value="" data-i18n-placeholder="placeholder_slam_2" placeholder="slam"/>
                    <label class="visually-hidden" for="slam_2" data-i18n="slam_2">slams</label>
                  </div>
                  <div class="slams__box slams__box--slam_3">
                    <input class="slams__slam_3 slams__input--text" name="attr_slam_3" id="slam_3" type="text" value="" data-i18n-placeholder="placeholder_slam_3" placeholder="slam"/>
                    <label class="visually-hidden" for="slam_3" data-i18n="slam_3">slams</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </section>
    </main>
    <footer class="footer"><span class="visually-hidden" data-i18n="version">Version</span><span name="attr_version"></span><span class="translation" data-i18n="style_1">1 style</span><span class="translation" data-i18n="trouble_1">1 trouble</span><span class="translation" data-i18n="style_2">2 style</span><span class="translation" data-i18n="trouble_2">2 trouble</span><span class="translation" data-i18n="style_3">3 style</span><span class="translation" data-i18n="trouble_3">3 trouble</span><span class="translation" data-i18n="style_4">4 style</span><span class="translation" data-i18n="trouble_4">4 trouble</span><span class="translation" data-i18n="style_5">5 style</span><span class="translation" data-i18n="trouble_5">5 trouble</span><span class="translation" data-i18n="grit_attitude">Describe how your grit helps your action, then boost or kick as needed. Also, refill 1 attitude whenever you fail any action. When the going gets tough, ya know?</span><span class="translation" data-i18n="grit_style">Get +1 style after runs where you show toughness or focus.</span><span class="translation" data-i18n="something_everyone_else_forgot">something everyone else forgot</span><span class="translation" data-i18n="backup_portaling_device">backup portaling device</span><span class="translation" data-i18n="patient">Patient</span><span class="translation" data-i18n="patient_description">When you reveal how you’ve been waiting to act, get +1d6 or +1 kick on your action.</span><span class="translation" data-i18n="sacrifice_your_body">Sacrifice Your Body</span><span class="translation" data-i18n="sacrifice_your_body_description">Take a slam (exhausted, strained, etc.) to get +2d6 to your action. This slam can’t be noped or avoided in any way. You gotta actually take it, kid.</span><span class="translation" data-i18n="diligent">Diligent</span><span class="translation" data-i18n="diligent_description">You can reroll In the Lab. Also clear +1 trouble when Being Good once per downtime.</span><span class="translation" data-i18n="walk_it_off">Walk It Off</span><span class="translation" data-i18n="walk_it_off_description">You gain 1 extra slam box. Mark 1 style every time you take a slam.</span><span class="translation" data-i18n="skill">Skill</span><span class="translation" data-i18n="skill_description">You’ve spent hours and hours practicing ______________. If this would help you with an action, you can mark 1 trouble to upgrade a 1–3 result into a 4/5 result.</span><span class="translation" data-i18n="grinding">Grinding</span><span class="translation" data-i18n="grinding_description">A scene where you work hard, prep carefully, wait patiently, fall and get back up, etc. +1 trait.</span><span class="translation" data-i18n="a_goal">A Goal</span><span class="translation" data-i18n="a_goal_description">A montage where you work towards a goal. Practicing an impossible trick in the driveway, building something no one believes in, saving change in a jar, etc. +1 slam (tired, blistered, etc.)</span><span class="translation" data-i18n="setbacks">Setbacks</span><span class="translation" data-i18n="setbacks_description">The work gets harder, progress slows, and now it’s raining. Your goal feels farther away than when you started, but you keep at it. +1 slam. What’s the crew think?</span><span class="translation" data-i18n="quitting">Quitting</span><span class="translation" data-i18n="quitting_description">The moment you finally give up. Why? What broke you? Who have you let down, besides yourself? +1 doom, +1 fracture.</span><span class="translation" data-i18n="perseverance">Perseverance</span><span class="translation" data-i18n="perseverance_description">You get back up and keep going. You always do. Who believed in you? −1 doom, −1 fracture, +2 legacy, +1 trait.</span><span class="translation" data-i18n="one_song_on_repeat">one song on repeat</span><span class="translation" data-i18n="never_smile">never smile</span><span class="translation" data-i18n="your_drink_matches_your_shoes">your drink matches your shoes</span><span class="translation" data-i18n="sleep_when_youre_dead">sleep when you’re dead</span><span class="translation" data-i18n="adult_in_residence">adult-in-residence</span><span class="translation" data-i18n="overachiever">overachiever</span><span class="translation" data-i18n="kitbashed">Kitbashed</span><span class="translation" data-i18n="kitbashed_cost"></span><span class="translation" data-i18n="kitbashed_description">Buy a mod from another device.</span><span class="translation" data-i18n="power_cell">Power Cell</span><span class="translation" data-i18n="power_cell_cost">2 gems</span><span class="translation" data-i18n="power_cell_description">Turbo gains 1 kick.</span><span class="translation" data-i18n="stabilizer">Stabilizer</span><span class="translation" data-i18n="stabilizer_cost">1 coil, 1 disc</span><span class="translation" data-i18n="stabilizer_description">Turbo gains 1 boost.</span><span class="translation" data-i18n="negafriction_sword_function">Roll to slice, dice, chop, and stab things (or nonlethally smack them with the kinetically-charged sheath).</span><span class="translation" data-i18n="negafriction_sword_description">Negafriction is just what it sounds like: complete nonsense. Normally, friction converts kinetic energy into heat, causing objects to slow down and get warmer. But negafriction swords speed up and get cooler. Just like you!</span><span class="translation" data-i18n="slip_rattle">Slip Rattle</span><span class="translation" data-i18n="slip_rattle_cost">1 coil, 1 disc</span><span class="translation" data-i18n="slip_rattle_description">Roll to teleport inuniverse by slicing spacetime. If you can’t see your destination, potential problems are worse.</span><span class="translation" data-i18n="field_projector">Field Projector</span><span class="translation" data-i18n="field_projector_cost">1 lens, 1 coil</span><span class="translation" data-i18n="field_projector_description">Roll to temporarily remove the surface friction from a room-sized area near you.</span><span class="translation" data-i18n="ref_coating">Ref Coating</span><span class="translation" data-i18n="ref_coating_cost">1 lens, 1 gem</span><span class="translation" data-i18n="ref_coating_description">Avoid slams from lasers and other electromagnetic energy by marking 1 turbo, redirecting the attack wherever you wish.</span><span class="translation" data-i18n="negafriction_wake">Negafriction Wake</span><span class="translation" data-i18n="negafriction_wake_cost">1 disc, 1 gem</span><span class="translation" data-i18n="negafriction_wake_description">Roll to boost your speed as your sword accelerates through matter (even air) and pulls you along.</span><span class="translation" data-i18n="subdimensional_edge">Subdimensional Edge</span><span class="translation" data-i18n="subdimensional_edge_cost">2 gems, 1 lens, 1 coil</span><span class="translation" data-i18n="subdimensional_edge_description">You can roll to temporarily slice entire dimensions off of a target, turning a 3D object 2D, for example, or removing someone from the timestream. The target re-coheres after a minute or two. It’s not pleasant, but mostly harmless.</span><span class="translation" data-i18n="your_phone">your phone</span><span class="translation" data-i18n="your_phone_cost"></span><span class="translation" data-i18n="your_phone_description"></span><span class="translation" data-i18n="grappling_hook">grappling hook</span><span class="translation" data-i18n="grappling_hook_cost"></span><span class="translation" data-i18n="grappling_hook_description"></span><span class="translation" data-i18n="spacetime_ampimeter">spacetime ampimeter</span><span class="translation" data-i18n="spacetime_ampimeter_cost"></span><span class="translation" data-i18n="spacetime_ampimeter_description"></span><span class="translation" data-i18n="hacking_tools">hacking tools</span><span class="translation" data-i18n="hacking_tools_cost"></span><span class="translation" data-i18n="hacking_tools_description"></span><span class="translation" data-i18n="multiversal_maps">multiversal maps</span><span class="translation" data-i18n="multiversal_maps_cost"></span><span class="translation" data-i18n="multiversal_maps_description"></span><span class="translation" data-i18n="repair_tools">repair tools</span><span class="translation" data-i18n="repair_tools_cost"></span><span class="translation" data-i18n="repair_tools_description"></span><span class="translation" data-i18n="small_drone">a small drone</span><span class="translation" data-i18n="small_drone_cost"></span><span class="translation" data-i18n="small_drone_description"></span><span class="translation" data-i18n="pro_camera_gear">pro camera gear</span><span class="translation" data-i18n="pro_camera_gear_cost"></span><span class="translation" data-i18n="pro_camera_gear_description"></span><span class="translation" data-i18n="peel_back_kit">peel back kit</span><span class="translation" data-i18n="peel_back_kit_cost"></span><span class="translation" data-i18n="peel_back_kit_description"></span><span class="translation" data-i18n="hazwear">hazwear</span><span class="translation" data-i18n="hazwear_cost"></span><span class="translation" data-i18n="hazwear_description"></span><span class="translation" data-i18n="backup_portaling_device">backup portaling device</span><span class="translation" data-i18n="backup_portaling_device_cost"></span><span class="translation" data-i18n="backup_portaling_device_description"></span><span class="translation" data-i18n="logic_binder">logic binder</span><span class="translation" data-i18n="logic_binder_cost"></span><span class="translation" data-i18n="logic_binder_description"></span><span class="translation" data-i18n="advanced_portal_tech">advanced portal tech</span><span class="translation" data-i18n="advanced_portal_tech_cost"></span><span class="translation" data-i18n="advanced_portal_tech_description"></span><span class="translation" data-i18n="hardecker_sludge_flares">Hardecker sludge flares</span><span class="translation" data-i18n="hardecker_sludge_flares_cost"></span><span class="translation" data-i18n="hardecker_sludge_flares_description"></span><span class="translation" data-i18n="hardlight_marker">hardlight marker</span><span class="translation" data-i18n="hardlight_marker_cost"></span><span class="translation" data-i18n="hardlight_marker_description"></span><span class="translation" data-i18n="maser_grenades">maser grenades</span><span class="translation" data-i18n="maser_grenades_cost"></span><span class="translation" data-i18n="maser_grenades_description"></span><span class="translation" data-i18n="smartcord">smartcord</span><span class="translation" data-i18n="smartcord_cost"></span><span class="translation" data-i18n="smartcord_description"></span><span class="translation" data-i18n="the_fust_mix">the FUST mix</span><span class="translation" data-i18n="the_fust_mix_cost"></span><span class="translation" data-i18n="the_fust_mix_description"></span><span class="translation" data-i18n="beam_filter">beam filter</span><span class="translation" data-i18n="beam_filter_cost"></span><span class="translation" data-i18n="beam_filter_description"></span><span class="translation" data-i18n="wilkies_gravity_stickers">Wilkie’S gravity stickers</span><span class="translation" data-i18n="wilkies_gravity_stickers_cost"></span><span class="translation" data-i18n="wilkies_gravity_stickers_description"></span><span class="translation" data-i18n="panic_energy_fuel_line">PANIC energy fuel-line</span><span class="translation" data-i18n="panic_energy_fuel_line_cost"></span><span class="translation" data-i18n="panic_energy_fuel_line_description"></span><span class="translation" data-i18n="fust_stasis_stickers">FUST stasis stickers</span><span class="translation" data-i18n="fust_stasis_stickers_cost"></span><span class="translation" data-i18n="fust_stasis_stickers_description"></span><span class="translation" data-i18n="aug_band">aug band</span><span class="translation" data-i18n="aug_band_cost"></span><span class="translation" data-i18n="aug_band_description"></span><span class="translation" data-i18n="particle_bond_tights">particle bond tights</span><span class="translation" data-i18n="particle_bond_tights_cost"></span><span class="translation" data-i18n="particle_bond_tights_description"></span><span class="translation" data-i18n="3d_printed_ablatine">3D-printed ablatine</span><span class="translation" data-i18n="3d_printed_ablatine_cost"></span><span class="translation" data-i18n="3d_printed_ablatine_description"></span><span class="translation" data-i18n="knock_off_scram_cat_tee">knock-off Scram Cat tee</span><span class="translation" data-i18n="knock_off_scram_cat_tee_cost"></span><span class="translation" data-i18n="knock_off_scram_cat_tee_description"></span><span class="translation" data-i18n="miper_escape_bag">Miper escape bag</span><span class="translation" data-i18n="miper_escape_bag_cost"></span><span class="translation" data-i18n="miper_escape_bag_description"></span><span class="translation" data-i18n="awf_bracelet">awf bracelet</span><span class="translation" data-i18n="awf_bracelet_cost"></span><span class="translation" data-i18n="awf_bracelet_description"></span><span class="translation" data-i18n="duraweave_jacket">duraweave jacket</span><span class="translation" data-i18n="duraweave_jacket_cost"></span><span class="translation" data-i18n="duraweave_jacket_description"></span><span class="translation" data-i18n="link_patch_duo">link patch duo</span><span class="translation" data-i18n="link_patch_duo_cost"></span><span class="translation" data-i18n="link_patch_duo_description"></span><span class="translation" data-i18n="slam_patch">slam patch</span><span class="translation" data-i18n="slam_patch_cost"></span><span class="translation" data-i18n="slam_patch_description"></span>
      <div style="display: flex; gap: 0.5rem">
        <div>
          <div style="background: #fff; width: 2rem; aspect-ratio: 1" title="white"></div>
        </div>
        <div>
          <div style="background: #8d74b3; width: 2rem; aspect-ratio: 1" title="purple-light"></div>
        </div>
        <div>
          <div style="background: #7151a0; width: 2rem; aspect-ratio: 1" title="purple"></div>
        </div>
        <div>
          <div style="background: #5a4180; width: 2rem; aspect-ratio: 1" title="purple-dark"></div>
        </div>
        <div>
          <div style="background: #f59ac2; width: 2rem; aspect-ratio: 1" title="pink-light"></div>
        </div>
        <div>
          <div style="background: #f281b3; width: 2rem; aspect-ratio: 1" title="pink"></div>
        </div>
        <div>
          <div style="background: #c2678f; width: 2rem; aspect-ratio: 1" title="pink-dark"></div>
        </div>
        <div>
          <div style="background: #eb008b; width: 2rem; aspect-ratio: 1" title="hot-pink"></div>
        </div>
        <div>
          <div style="background: #339daa; width: 2rem; aspect-ratio: 1" title="teal-light"></div>
        </div>
        <div>
          <div style="background: #008495; width: 2rem; aspect-ratio: 1" title="teal"></div>
        </div>
        <div>
          <div style="background: #006a77; width: 2rem; aspect-ratio: 1" title="teal-dark"></div>
        </div>
        <div>
          <div style="background: #34bdf2; width: 2rem; aspect-ratio: 1" title="blue-light"></div>
        </div>
        <div>
          <div style="background: #01acef; width: 2rem; aspect-ratio: 1" title="blue"></div>
        </div>
        <div>
          <div style="background: #018abf; width: 2rem; aspect-ratio: 1" title="blue-dark"></div>
        </div>
        <div>
          <div style="background: #f26f5a; width: 2rem; aspect-ratio: 1" title="red-light"></div>
        </div>
        <div>
          <div style="background: #ef4b31; width: 2rem; aspect-ratio: 1" title="red"></div>
        </div>
        <div>
          <div style="background: #bf3c27; width: 2rem; aspect-ratio: 1" title="red-dark"></div>
        </div>
        <div>
          <div style="background: #ffd45c; width: 2rem; aspect-ratio: 1" title="yellow"></div>
        </div>
        <div>
          <div style="background: #19a56f; width: 2rem; aspect-ratio: 1" title="green"></div>
        </div>
        <div>
          <div style="background: rgb(237, 237, 237); width: 2rem; aspect-ratio: 1" title="light-grey"></div>
        </div>
        <div>
          <div style="background: rgb(153, 153, 153); width: 2rem; aspect-ratio: 1" title="mid-grey"></div>
        </div>
        <div>
          <div style="background: rgb(68, 68, 68); width: 2rem; aspect-ratio: 1" title="dark-grey"></div>
        </div>
        <div>
          <div style="background: #292828; width: 2rem; aspect-ratio: 1" title="black"></div>
        </div>
      </div>
    </footer>
  </div>
</div>
<!-- === WORKERS ===-->
<script type="text/worker">
  const G_SHEET_MODES = ['character', 'crew'];

const G_EDITORS = ['gear', 'your_character', 'traits', 'legacy', 'doom', 'signature'];

const G_REPEATING_FIELDSETS = [
  // character
  'gear',
  'traits',
  'mods',
  'legacy',
  'doom',

  // crew sheet
  'crews',
  'sponsors',
  'fractures',
  'authorities',
  'sponsors',
  'crowds',
];

const G_PLAYBOOKS = {
  grit: {
    attitude: { boost: 3, kick: 1 },
    traits: ['patient', 'sacrifice_your_body', 'diligent', 'walk_it_off', 'skill'],
    gear: ['something_everyone_else_forgot', 'backup_portaling_device'],
    beat: { grinding: '2_style' },
    arc: [
      { a_goal: '1_style' },
      { setbacks: '2_style' },
      { quitting: '4_trouble' },
      { perseverance: '3_style' },
    ],
    vibes: [
      'one_song_on_repeat',
      'never_smile',
      'your_drink_matches_your_shoes',
      'sleep_when_youre_dead',
      'adult_in_residence',
      'overachiever',
    ],
  },
  guts: {
    attitude: { boost: 1, kick: 3 },
    traits: [],
    gear: [],
    beat: [''],
    arc: [],
  },
  smart: {
    attitude: { boost: 2, kick: 2 },
    traits: [],
    gear: [],
    beat: [''],
    arc: [],
  },
  chill: {
    attitude: { boost: 1, kick: 2 },
    traits: [],
    gear: [],
    beat: [''],
    arc: [],
  },
  chill: {
    attitude: { boost: 1, kick: 0 },
    traits: [],
    gear: [],
    beat: [''],
    arc: [],
  },
};

const G_SIGNATURES = {
  negafriction_sword: {
    mods: [
      'slip_rattle',
      'field_projector',
      'ref_coating',
      'negafriction_wake',
      'subdimensional_edge',
      'kitbashed',
    ],
    looks: [],
  },
  gravity_blaster: {},
  hardlight_board: {},
  hyperoptic_visor: {},
  kinetic_deck: {},
  photonic_jacket: {},
  powered_armour: {},
  reality_cannon: {},
  riftninja_sneakers: {},
  robotic_companion: {},
  skipmode_runners: {},
  voidwear_backpack: {},
};

const G_IMPORT_DATA_MAP = {
  traits: [],
};

const G_EXTRA_GEAR = [
  'your_phone',
  'personal_gear_1',
  'personal_gear_2',
  'grappling_hook',
  'spacetime_ampimeter',
  'hacking_tools',
  'multiversal_maps',
  'repair_tools',
  'small_drone',
  'pro_camera_gear',
  'peel_back_kit',
  'hazwear',
  'backup_portaling_device',
  'logic_binder',
  'advanced_portal_tech',
  'hardecker_sludge_flares',
  'hardlight_marker',
  'maser_grenades',
  'smartcord',
  'the_fust_mix',
  'beam_filter',
  'wilkies_gravity_stickers',
  'panic_energy_fuel_line',
  'fust_stasis_stickers',
  'aug_band',
  'particle_bond_tights',
  '3d_printed_ablatine',
  'knock_off_scram_cat_tee',
  'miper_escape_bag',
  'awf_bracelet',
  'duraweave_jacket',
  'link_patch_duo',
  'slam_patch',
];
  // Switch between sheet modes
G_SHEET_MODES.forEach((mode) => {
  on(`clicked:${mode}`, (eventInfo) => {
    setAttrs({ sheet_mode: mode });
  });
});

// Edit / View panel modes
G_EDITORS.forEach((toggle) => {
  on(`clicked:${toggle}-editor`, (eventInfo) => {
    getAttrs([`${toggle}_editor`], (values) => {
      const value = values[`${toggle}_editor`] === '0' ? 'on' : '0';
      setAttrs({ [`${toggle}_editor`]: value });
    });
  });
});

// Update empty fieldsets
G_REPEATING_FIELDSETS.forEach((fieldset) => {
  on(`change:repeating_${fieldset} remove:repeating_${fieldset}`, async (eventInfo) =>
    isFieldsetEmpty(fieldset)
  );
});

// Load personality data
on(`change:personality`, (eventInfo) => {
  let personality = eventInfo.newValue;
  personality = personality.trim().replace(' ', '_').toLowerCase();
  if (personality) loadPersonality(personality);
});

// Load signature data
on(`change:signature`, (eventInfo) => {
  let signature = eventInfo.newValue;
  signature = signature.trim().replace(' ', '_').toLowerCase();
  console.log(signature);
  if (signature) loadSignature(signature);
});

// Style & Trouble
on('clicked:nope', (eventInfo) => nopeTrouble());
  const getSectionID = (eventInfo) => eventInfo.sourceAttribute.split('_').at(2);

const doNumcontrol = (numcontrol, step, min = null, max = null) => {
  getAttrs([numcontrol, numcontrol + '_max'], (values) => {
    let value = +values[numcontrol] || 0;
    value += step;

    if (min !== null) value = Math.max(value, min);

    if (max !== null) {
      if (isNaN(max)) {
        let value_max = +values[max];
        value = Math.min(value, value_max);
      } else value = Math.min(value, max);
    }

    setAttrs({ [numcontrol]: value });
  });
};

const nopeTrouble = () => {
  getAttrs(['trouble', 'trouble_max'], (values) => {
    const max = +values.trouble_max || 8;
    const current = +values.trouble || 0;
    const newValue = Math.min(current + 2, max);
    setAttrs({ trouble: newValue });
  });
};

const loadPersonality = (personality) => {
  const isValid = G_PLAYBOOKS.hasOwnProperty(personality);
  if (!isValid) return;

  const update = {};
  const data = G_PLAYBOOKS[personality];

  // personal gear
  data.gear.forEach((gear, index) => {
    const personalGear = `personal_gear_${index + 1}_name`;
    update[personalGear] = gear;
  });

  // attitude
  const { boost, kick } = data.attitude;
  update.attitude_boost = boost;
  update.attitude_kick = kick;
  update.attitude_subtitle = getTranslationByKey(`${personality}_attitude`);

  // style & trouble
  update.style_run_bonus = getTranslationByKey(`${personality}_style`);

  // traits
  // importFieldset('traits', data.traits);

  // console.table(update);
  setAttrs(update);
};

const loadSignature = (signature) => {
  const isValid = G_SIGNATURES.hasOwnProperty(signature);
  if (!isValid) return;

  const update = {};
  const data = G_SIGNATURES[signature];

  // text stuff
  update.signature_function = getTranslationByKey(`${signature}_function`);
  update.signature_description = getTranslationByKey(`${signature}_description`);

  // mods
  // importFieldset('mods', data.mods);

  //
  setAttrs(update);
};

// https://wiki.roll20.net/Sheet_Worker_Scripts#WARNING
/**
 * Need to map from attribute data map to populate translations
 * getAllAttrs to leave user created rows in the repeating section
 * @param {*} fieldset
 * @param {*} data
 */
const importFieldset = (fieldset, data) => {
  getSectionIDs(`repeating_${fieldset}`, (sections) => {
    const update = {};

    data.forEach((key) => {
      let rowId = generateRowID();
      while (rowId in sections) {
        rowId = generateRowID();
      }
      sections.push(rowId);

      const repeatingPrefix = `repeating_${fieldset}_${rowId}_trait_`;
      update[repeatingPrefix + 'name'] = getTranslationByKey(key);
      update[repeatingPrefix + 'description'] = getTranslationByKey(key + '_description');
      update[repeatingPrefix + 'autogen'] = 1;
    });

    console.log(update);
    setAttrs(update);
  });
};
  /**
 * Checks if a repeating fieldset is empty by counting the
 * number of sections inside the fieldset.
 * @param {string} fieldset
 */
const isFieldsetEmpty = (fieldset) => {
  getSectionIDs(`repeating_${fieldset}`, (sections) => {
    setAttrs({ [`${fieldset}_empty`]: sections.length });
  });
};

/**
  Gets all attributes, both repeating and non-repeating.
  Default sectionDetails to a shallow clone of the global G_DEFAULT_REPEATING;
  We're cloning because we'll be manipulating the array.
  @param sectionDetails:  an object containing the idArrays for each
    repeating section, sorted based on their current order.
    Example:
      const G_DEFAULT_REPEATING = [
        { section: "repeating_inventory", fields: ["weight", "name", "quantity"] },
        { section: "repeating_attack", fields: ["bonus", "damage", "name"] },
      ];
  @param getArray: an object containing all the attribute values
  @returns
    @param attributes: similar to getAttrs; object containing field names as key and values.
    @param sections: similar to getSectionIDs; object containing fieldset name
      as key and array of IDs as value.
**/
const getAllAttrs = function (callback, sectionDetails = [], getArray = []) {
  getSections(getArray, sectionDetails, (getArr, sections) => {
    getAttrs(getArr, (attributes) => {
      // order the sections
      orderSections(attributes, sections);
      // call the callback function to finally do what we wanted to do.
      callback(attributes, sections);
    });
  });
};

/**
  Gets the rowIDs for all the sections passed to it,
  and assembles an array of repeating attributes to get
  Does this via a work queue or burndown set up
  Arguments are the same as for getAllAttrs with the addition of sections
  @param sections: accumulates the idArrays for each section
**/
const getSections = function (getArray = [], sectionDetails = [], callback, sections = {}) {
  // grab the first section to work;
  let section = sectionDetails.shift();
  getSectionIDs(section.section, (idArray) => {
    // store the idArray for use later on if needed.
    sections[section.section] = [...idArray];

    // add the sections reporder to the getArray so that we can order the idArray later.
    getArray.push(`_reporder_${section.section}`);
    // iterate through the ids
    idArray.forEach((id) => {
      // Iterate through each of the fields for the repeating section
      section.fields.forEach((field) => {
        // add the repeating attribute for this id to the getArray
        getArray.push(`${section.section}_${id}_${field}`);
      });
    });
    if (sectionDetails[0]) {
      // If there's another section to work through, go through the burndown again
      getSections(getArray, sectionDetails, callback, sections);
    } else {
      // If no sections are left, call the callback
      callback(getArray, sections);
    }
  });
};

// The next three functions are only used for the ID ordering.
// orders the section id arrays to match the repOrder attribute
const orderSections = function (attributes, sections) {
  Object.keys(sections).forEach((section) => {
    attributes[`_reporder_${section}`] = commaArray(attributes[`_reporder_${section}`]);
    orderSection(attributes[`_reporder_${section}`], sections[section]);
  });
};

// splits a comma delimited string into an array
const commaArray = function (string = '') {
  return string.toLowerCase().split(/\s*,\s*/);
};

// orders a single ID array
const orderSection = function (repOrder, IDs = []) {
  IDs.sort((a, b) => {
    return repOrder.indexOf(a.toLowerCase()) - repOrder.indexOf(b.toLowerCase());
  });
};

</script>